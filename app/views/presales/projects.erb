<script src="/javascripts/jquery-1.11.1.min.js" type="text/javascript"></script>
<script type="text/javascript">
  var $j = jQuery.noConflict();
</script>
<script src="/javascripts/tool.js"></script>

<div id="priority_milestones"></div>

<% form_tag(:action=>'projects') do %>
 Type: <%= select_tag ("presale_presale_type",options_for_select(@presale_types,@presale_presale_type_id.to_i))  %>
  <%= submit_tag('Filter') %>
<% end %>

<h3>Projects without opportunities <% if @presales_types_by_id != nil and @presale_presale_type_idto_i != 0 %> for type <%= @presales_types_by_id[@presale_presale_type_id.to_s] %><% end %></h3>
<table id="presales_table_1" class="sortable">
<thead>
	<tr><th class="priority_setting_up">Priority Setting-up</th><th class="priority">Priority</th><th>ID</th><th>Name</th><th>Workstream</th><th>PM</th><th>Suite Name</th><th></th>
  <% if @presale_presale_type_id != nil and @presale_presale_type_idto_i != 0 %>
    <th></th>
  <% end %>
  </tr>
</thead>
<tbody>
<% i = 0 %>
<% @projects.each do |p| %>
	<% name = "" %>
	<% name += p.project.name+" > " if p.project %>
	<% name += p.name %>

	<tr>
		<td><%= Presale.get_priority_message(p.get_priority) %></td>
		<td><%= Presale.get_priority_message(p.get_setting_up_priority) %></td>	
		<td><%= p.id %></td>
		<td><%=link_to(name, :controller=>'projects', :action=>'show', :id=>p.id) %></td>
		<td><%= p.workstream %></td>
		<td><%= p.pm %></td>
		<td><%= p.suite_tag.name if p.suite_tag %></td>
		<td><%= button_to "Presale",  {:action=>'show_presale', :id=>p.id} %></td>
    <% if @presale_presale_type_id != nil and @presale_presale_type_id.to_i != 0 %>
      <td><%= button_to "Ignore for #{@presales_types_by_id[@presale_presale_type_id.to_s]}", {:action=>'ignore_presale', :id=>p.id, :presale_type_id=>@presale_presale_type_id} %></td>
    <% end %>
	</tr>

	<% i = i + 1 %>
<% end %>
</tbody>
</table>

<script type="text/javascript">
  jQuery( document ).ready(function() {

    jQuery(".priority_setting_up").hover(
      function(e) {
        jQuery("#priority_milestones").show();
        jQuery("#priority_milestones").html("<%= APP_CONFIG['presale_milestones_priority_setting_up'].join(',') %>");
        jQuery("#priority_milestones").css({top:e.pageY, left:e.pageX});
      }, function() {
      	 jQuery("#priority_milestones").hide();
      }
    );
  });
  jQuery( document ).ready(function() {
    jQuery(".priority").hover(
      function(e) {
        jQuery("#priority_milestones").show();
        jQuery("#priority_milestones").html("<%= APP_CONFIG['presale_milestones_priority'].join(',') %>");
        jQuery("#priority_milestones").css({top:e.pageY, left:e.pageX});
      }, function() {
      	 jQuery("#priority_milestones").hide();
      }
    );
  });
 </script>